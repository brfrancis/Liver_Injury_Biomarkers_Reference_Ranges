#data<-read.csv("C:\\Users/brfra/Dropbox/CDSS/Dan/Healthy/healthy090817study1_2.csv",sep=",",header=TRUE)
data<-read.csv("/home/ben/Dropbox/CDSS/Dan/Healthy/healthy090817study1_2.csv",sep=",",header=TRUE)
data$Eth=relevel(data$Ethnicity,ref="White")
resetPar <- function() {
  dev.new()
  op <- par(no.readonly = TRUE)
  dev.off()
  op
}

outlierKDalt <- function(dt, var) {
  var_name <- eval(substitute(var),eval(dt))
  na1 <- sum(is.na(var_name))
  m1 <- mean(var_name, na.rm = T)
  par(mfrow=c(2, 2), oma=c(0,0,3,0))
  boxplot(var_name, main="With outliers")
  hist(var_name, main="With outliers", xlab=NA, ylab=NA)
  outlier <- boxplot.stats(var_name)$out
  mo <- mean(outlier)
  var_name <- ifelse(var_name %in% outlier, NA, var_name)
  boxplot(var_name, main="Without outliers")
  hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
  title("Outlier Check", outer=TRUE)
  na2 <- sum(is.na(var_name))
  cat("Outliers identified:", na2 - na1, "\n")
  cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "\n")
  cat("Mean of the outliers:", round(mo, 2), "\n")
  m2 <- mean(var_name, na.rm = T)
  cat("Mean without removing outliers:", round(m1, 2), "\n")
  cat("Mean if we remove outliers:", round(m2, 2), "\n")
  par(resetPar())
  dt[as.character(substitute(var))] <- invisible(var_name)
  assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
  cat("Outliers successfully removed", "\n")
  return(invisible(dt))
}

library(lme4)
library(car)
library(MASS)
library(xts)
library(RLRsim)
library(outliers)
library(quantreg)
library(jmuOutlier)


##########################################################################################################################
# ALT 
##########################################################################################################################

bio=data$ALT

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tALT=sqrt(bio)
outlierKDalt(data, tALT)
data$tALT=data$tALT^2

###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# miR.122let 
##########################################################################################################################

bio=data$miR.122let

###############################################################
# Transform Chosen - log
###############################################################

#Trans Data
data$tmiR.122let=log(bio)
outlierKDalt(data, tmiR.122let)
data$tmiR.122let=exp(data$tmiR.122let)

###############################################################
# Outliers Removed - 1
###############################################################

##########################################################################################################################
# miR.122copies
##########################################################################################################################

bio=data$miR.122copies

###############################################################
# Transform Chosen - log
###############################################################

#Trans Data
data$tmiR.122copies=log(bio)
outlierKDalt(data, tmiR.122copies)
data$tmiR.122copies=exp(data$tmiR.122copies)

###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# HMGB1
##########################################################################################################################

bio=data$HMGB1

###############################################################
# Transform Chosen - norm
###############################################################

#Trans Data
data$tHMGB1=bio
outlierKDalt(data, tHMGB1)

###############################################################
# Outliers Removed - 2
###############################################################

##########################################################################################################################
# ccK18
##########################################################################################################################

bio=data$ccK18

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tccK18=sqrt(bio)
outlierKDalt(data, tccK18)
data$tccK18=data$tccK18^2

###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# FL.K18
##########################################################################################################################

bio=data$FL.K18

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tFL.K18=sqrt(bio)
outlierKDalt(data, tFL.K18)
data$tFL.K18=data$tFL.K18^2

###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# GLDH
##########################################################################################################################

bio=data$GLDH

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tGLDH=sqrt(bio)
outlierKDalt(data, tGLDH)
data$tGLDH=data$tGLDH^2

###############################################################
# Outliers Removed - 12
###############################################################

##########################################################################################################################
# CSF.1
##########################################################################################################################

bio=data$CSF.1

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tCSF.1=sqrt(bio)
outlierKDalt(data, tCSF.1)
data$tCSF.1=data$tCSF.1^2

###############################################################
# Outliers Removed - 0
###############################################################

write.csv(data,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy090817study1_2outliers.csv",quote=FALSE,sep=",")


##########################################################################################################################
##########################################################################################################################
##########################################################################################################################
# Study 3 
##########################################################################################################################
##########################################################################################################################
##########################################################################################################################


data<-read.csv("/home/ben/Dropbox/CDSS/Dan/Healthy/healthy090817study3.csv",sep=",",header=TRUE)
#data<-read.csv("C:\\Users/brfra/Dropbox/CDSS/Dan/Healthy/healthy090817study3.csv",sep=",",header=TRUE)

##########################################################################################################################
# ALT 
##########################################################################################################################

bio=data$ALT

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tbio=sqrt(bio)
outlierKDalt(data, tbio)
tbio=data$tbio^2
tALT=cbind(tbio[data$TP==1],tbio[data$TP==2],tbio[data$TP==3],tbio[data$TP==4],tbio[data$TP==5],tbio[data$TP==6],tbio[data$TP==7],tbio[data$TP==8],tbio[data$TP==9])
write.csv(tALT,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy290817study3_ALT_outliers.csv",quote=FALSE,sep=",")

###############################################################
# Outliers Removed - 6
###############################################################

##########################################################################################################################
# miR.122let 
##########################################################################################################################

bio=data$miR.122

###############################################################
# Transform Chosen - log
###############################################################

#Trans Data
data$tbio=log(bio)
outlierKDalt(data, tbio)
tbio=exp(data$tbio)
tmiR.122=cbind(tbio[data$TP==1],tbio[data$TP==2],tbio[data$TP==3],tbio[data$TP==4],tbio[data$TP==5],tbio[data$TP==6],tbio[data$TP==7],tbio[data$TP==8],tbio[data$TP==9])
write.csv(tmiR.122,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy290817study3_miR122_outliers.csv",quote=FALSE,sep=",")

###############################################################
# Outliers Removed - 3
###############################################################

##########################################################################################################################
# HMGB1
##########################################################################################################################

bio=data$HMGB1

###############################################################
# Transform Chosen - sqrt
###############################################################

data$tbio=sqrt(bio)
outlierKDalt(data, tbio)
tbio=(data$tbio)^2
tHMGB1=cbind(tbio[data$TP==1],tbio[data$TP==2],tbio[data$TP==3],tbio[data$TP==4],tbio[data$TP==5],tbio[data$TP==6],tbio[data$TP==7],tbio[data$TP==8],tbio[data$TP==9])
write.csv(tHMGB1,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy290817study3_HMGB1_outliers.csv",quote=FALSE,sep=",")

###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# ccK18
##########################################################################################################################

bio=data$ccK18

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tbio=sqrt(bio)
outlierKDalt(data, tbio)
tbio=(data$tbio)^2
tccK18=cbind(tbio[data$TP==1],tbio[data$TP==2],tbio[data$TP==3],tbio[data$TP==4],tbio[data$TP==5],tbio[data$TP==6],tbio[data$TP==7],tbio[data$TP==8],tbio[data$TP==9])
write.csv(tccK18,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy290817study3_ccK18_outliers.csv",quote=FALSE,sep=",")


###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# FL.K18
##########################################################################################################################

bio=data$FL.K18

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tbio=sqrt(bio)
outlierKDalt(data, tbio)
tbio=(data$tbio)^2
tFL.K18=cbind(tbio[data$TP==1],tbio[data$TP==2],tbio[data$TP==3],tbio[data$TP==4],tbio[data$TP==5],tbio[data$TP==6],tbio[data$TP==7],tbio[data$TP==8],tbio[data$TP==9])
write.csv(tFL.K18,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy290817study3_FLK18_outliers.csv",quote=FALSE,sep=",")


###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# GLDH
##########################################################################################################################

bio=data$GLDH

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tbio=sqrt(bio)
outlierKDalt(data, tbio)
tbio=(data$tbio)^2
tGLDH=cbind(tbio[data$TP==1],tbio[data$TP==2],tbio[data$TP==3],tbio[data$TP==4],tbio[data$TP==5],tbio[data$TP==6],tbio[data$TP==7],tbio[data$TP==8],tbio[data$TP==9])
write.csv(tGLDH,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy290817study3_GLDH_outliers.csv",quote=FALSE,sep=",")


###############################################################
# Outliers Removed - 0
###############################################################

##########################################################################################################################
# CSF.1
##########################################################################################################################

bio=data$CSF.1

###############################################################
# Transform Chosen - sqrt
###############################################################

#Trans Data
data$tbio=sqrt(bio)
outlierKDalt(data, tbio)
tbio=(data$tbio)^2
tCSF.1=cbind(tbio[data$TP==1],tbio[data$TP==2],tbio[data$TP==3],tbio[data$TP==4],tbio[data$TP==5],tbio[data$TP==6],tbio[data$TP==7],tbio[data$TP==8],tbio[data$TP==9])
write.csv(tCSF.1,file="/home/ben/Dropbox/CDSS/Dan/Healthy/healthy290817study3_CSF1_outliers.csv",quote=FALSE,sep=",")


###############################################################
# Outliers Removed - 0
###############################################################

